var ue=Object.defineProperty;var _e=(e,t)=>{for(var i in t)ue(e,i,{get:t[i],enumerable:!0})};var z={};_e(z,{f32:()=>M,f64:()=>F,i16:()=>ye,i32:()=>N,i64:()=>q,i8:()=>ge,uleb:()=>o,uleb5:()=>he});var _=e=>{throw Error(e)};var Z=/^_|_$|[^\da-f]_|_[^\da-f]/i,ee=/^[+-]?(?:0x[\da-f]+|\d+)$/i,ce=new TextEncoder,pe=new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0}),Q={n:10,r:13,t:9,'"':34,"'":39,"\\":92},D=e=>{let t=[],i=1,r,a,l="",s=()=>(l&&t.push(...ce.encode(l)),l="");for(;i<e.length-1;)a=e[i++],r=null,a==="\\"&&(e[i]==="u"?(i++,i++,a=String.fromCodePoint(parseInt(e.slice(i,i=e.indexOf("}",i)),16)),i++):Q[e[i]]?r=Q[e[i++]]:isNaN(r=parseInt(e[i]+e[i+1],16))?a+=e[i]:(i++,i++)),r!=null?(s(),t.push(r)):l+=a;return s(),t.valueOf=()=>e,t},te=e=>pe.decode(new Uint8Array(D(e)));var o=(e,t=[])=>{if(e==null)return t;if(typeof e=="string"&&(e=/[_x]/i.test(e)?BigInt(e.replaceAll("_","")):N.parse(e)),typeof e=="bigint"){for(;;){let r=Number(e&0x7Fn);if(e>>=7n,e===0n){t.push(r);break}t.push(r|128)}return t}let i=e&127;return e>>>=7,e===0?(t.push(i),t):(t.push(i|128),o(e,t))};function he(e){let t=[];for(let i=0;i<5;i++){let r=e&127;e>>>=7,i<4&&(r|=128),t.push(r)}return t}function N(e,t=[]){for(typeof e=="string"&&(e=N.parse(e));;){let i=Number(e&127);if(e>>=7,e===0&&!(i&64)||e===-1&&i&64){t.push(i);break}t.push(i|128)}return t}var ie=e=>!Z.test(e)&&ee.test(e=e.replaceAll("_",""))?e:_(`Bad int ${e}`),ge=N,ye=N;N.parse=e=>(e=parseInt(ie(e)),(e<-2147483648||e>4294967295)&&_("i32 constant out of range"),e);function q(e,t=[]){for(typeof e=="string"&&(e=q.parse(e));;){let i=Number(e&0x7Fn);if(e>>=7n,e===0n&&!(i&64)||e===-1n&&i&64){t.push(i);break}t.push(i|128)}return t}q.parse=e=>(e=ie(e),e=e[0]==="-"?-BigInt(e.slice(1)):BigInt(e),(e<-0x8000000000000000n||e>0xffffffffffffffffn)&&_("i64 constant out of range"),d.setBigInt64(0,e),d.getBigInt64(0));var d=new DataView(new Float64Array(1).buffer),de=2147483648,be=2139095040;function M(e,t,i){return typeof e=="string"&&~(i=e.indexOf("nan:"))?(t=N.parse(e.slice(i+4)),t|=be,e[0]==="-"&&(t|=de),d.setInt32(0,t)):(t=typeof e=="string"?M.parse(e):e,d.setFloat32(0,t)),[d.getUint8(3),d.getUint8(2),d.getUint8(1),d.getUint8(0)]}var we=0x8000000000000000n,Ae=0x7ff0000000000000n;function F(e,t,i){return typeof e=="string"&&~(i=e.indexOf("nan:"))?(t=q.parse(e.slice(i+4)),t|=Ae,e[0]==="-"&&(t|=we),d.setBigInt64(0,t)):(t=typeof e=="string"?F.parse(e):e,d.setFloat64(0,t)),[d.getUint8(7),d.getUint8(6),d.getUint8(5),d.getUint8(4),d.getUint8(3),d.getUint8(2),d.getUint8(1),d.getUint8(0)]}F.parse=(e,t=Number.MAX_VALUE)=>{e=e.replaceAll("_","");let i=1;if(e[0]==="-"?(i=-1,e=e.slice(1)):e[0]==="+"&&(e=e.slice(1)),e[1]==="x"){let[r,a="0"]=e.split(/p/i),[l,s=""]=r.split("."),f=s.length??0,n=parseInt(l);isNaN(n)&&_();let m=s?parseInt("0x"+s)/16**f:0;a=parseInt(a,10);let x=i*(n+m)*2**a;return x=Math.max(-t,Math.min(t,x)),x}return e.includes("nan")?i<0?NaN:NaN:e.includes("inf")?i*(1/0):i*parseFloat(e)};M.parse=e=>F.parse(e,34028234663852886e22);var k=["unreachable","nop","block block","loop block","if block","else null","then null",,"throw tagidx",,"throw_ref","end end","br labelidx","br_if labelidx","br_table br_table","return","call funcidx","call_indirect call_indirect","return_call funcidx","return_call_indirect call_indirect","call_ref typeidx","return_call_ref typeidx",,,,,"drop","select select","",,,"try_table try_table","local.get localidx","local.set localidx","local.tee localidx","global.get globalidx","global.set globalidx","table.get tableidx","table.set tableidx",,"i32.load memarg","i64.load memarg","f32.load memarg","f64.load memarg","i32.load8_s memarg","i32.load8_u memarg","i32.load16_s memarg","i32.load16_u memarg","i64.load8_s memarg","i64.load8_u memarg","i64.load16_s memarg","i64.load16_u memarg","i64.load32_s memarg","i64.load32_u memarg","i32.store memarg","i64.store memarg","f32.store memarg","f64.store memarg","i32.store8 memarg","i32.store16 memarg","i64.store8 memarg","i64.store16 memarg","i64.store32 memarg","memory.size opt_memory","memory.grow opt_memory","i32.const i32","i64.const i64","f32.const f32","f64.const f64","i32.eqz","i32.eq","i32.ne","i32.lt_s","i32.lt_u","i32.gt_s","i32.gt_u","i32.le_s","i32.le_u","i32.ge_s","i32.ge_u","i64.eqz","i64.eq","i64.ne","i64.lt_s","i64.lt_u","i64.gt_s","i64.gt_u","i64.le_s","i64.le_u","i64.ge_s","i64.ge_u","f32.eq","f32.ne","f32.lt","f32.gt","f32.le","f32.ge","f64.eq","f64.ne","f64.lt","f64.gt","f64.le","f64.ge","i32.clz","i32.ctz","i32.popcnt","i32.add","i32.sub","i32.mul","i32.div_s","i32.div_u","i32.rem_s","i32.rem_u","i32.and","i32.or","i32.xor","i32.shl","i32.shr_s","i32.shr_u","i32.rotl","i32.rotr","i64.clz","i64.ctz","i64.popcnt","i64.add","i64.sub","i64.mul","i64.div_s","i64.div_u","i64.rem_s","i64.rem_u","i64.and","i64.or","i64.xor","i64.shl","i64.shr_s","i64.shr_u","i64.rotl","i64.rotr","f32.abs","f32.neg","f32.ceil","f32.floor","f32.trunc","f32.nearest","f32.sqrt","f32.add","f32.sub","f32.mul","f32.div","f32.min","f32.max","f32.copysign","f64.abs","f64.neg","f64.ceil","f64.floor","f64.trunc","f64.nearest","f64.sqrt","f64.add","f64.sub","f64.mul","f64.div","f64.min","f64.max","f64.copysign","i32.wrap_i64","i32.trunc_f32_s","i32.trunc_f32_u","i32.trunc_f64_s","i32.trunc_f64_u","i64.extend_i32_s","i64.extend_i32_u","i64.trunc_f32_s","i64.trunc_f32_u","i64.trunc_f64_s","i64.trunc_f64_u","f32.convert_i32_s","f32.convert_i32_u","f32.convert_i64_s","f32.convert_i64_u","f32.demote_f64","f64.convert_i32_s","f64.convert_i32_u","f64.convert_i64_s","f64.convert_i64_u","f64.promote_f32","i32.reinterpret_f32","i64.reinterpret_f64","f32.reinterpret_i32","f64.reinterpret_i64","i32.extend8_s","i32.extend16_s","i64.extend8_s","i64.extend16_s","i64.extend32_s",,,,,,,,,,,,"ref.null ref_null","ref.is_null","ref.func funcidx","ref.eq","ref.as_non_null","br_on_null labelidx","br_on_non_null labelidx",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,["struct.new typeidx","struct.new_default typeidx","struct.get typeidx_field","struct.get_s typeidx_field","struct.get_u typeidx_field","struct.set typeidx_field","array.new typeidx","array.new_default typeidx","array.new_fixed typeidx_multi","array.new_data typeidx_dataidx","array.new_elem typeidx_elemidx","array.get typeidx","array.get_s typeidx","array.get_u typeidx","array.set typeidx","array.len","array.fill typeidx","array.copy typeidx_typeidx","array.init_data typeidx_dataidx","array.init_elem typeidx_elemidx","ref.test reftype","","ref.cast reftype","","br_on_cast reftype2","br_on_cast_fail reftype2","any.convert_extern","extern.convert_any","ref.i31","i31.get_s","i31.get_u"],["i32.trunc_sat_f32_s","i32.trunc_sat_f32_u","i32.trunc_sat_f64_s","i32.trunc_sat_f64_u","i64.trunc_sat_f32_s","i64.trunc_sat_f32_u","i64.trunc_sat_f64_s","i64.trunc_sat_f64_u","memory.init dataidx_memoryidx","data.drop dataidx","memory.copy memoryidx_memoryidx","memory.fill memoryidx?","table.init reversed","elem.drop elemidx","table.copy tableidx_tableidx","table.grow tableidx","table.size tableidx","table.fill tableidx",,"i64.add128","i64.sub128","i64.mul_wide_s","i64.mul_wide_u"],["v128.load memarg","v128.load8x8_s memarg","v128.load8x8_u memarg","v128.load16x4_s memarg","v128.load16x4_u memarg","v128.load32x2_s memarg","v128.load32x2_u memarg","v128.load8_splat memarg","v128.load16_splat memarg","v128.load32_splat memarg","v128.load64_splat memarg","v128.store memarg","v128.const v128const","i8x16.shuffle shuffle","i8x16.swizzle","i8x16.splat","i16x8.splat","i32x4.splat","i64x2.splat","f32x4.splat","f64x2.splat","i8x16.extract_lane_s laneidx","i8x16.extract_lane_u laneidx","i8x16.replace_lane laneidx","i16x8.extract_lane_s laneidx","i16x8.extract_lane_u laneidx","i16x8.replace_lane laneidx","i32x4.extract_lane laneidx","i32x4.replace_lane laneidx","i64x2.extract_lane laneidx","i64x2.replace_lane laneidx","f32x4.extract_lane laneidx","f32x4.replace_lane laneidx","f64x2.extract_lane laneidx","f64x2.replace_lane laneidx","i8x16.eq","i8x16.ne","i8x16.lt_s","i8x16.lt_u","i8x16.gt_s","i8x16.gt_u","i8x16.le_s","i8x16.le_u","i8x16.ge_s","i8x16.ge_u","i16x8.eq","i16x8.ne","i16x8.lt_s","i16x8.lt_u","i16x8.gt_s","i16x8.gt_u","i16x8.le_s","i16x8.le_u","i16x8.ge_s","i16x8.ge_u","i32x4.eq","i32x4.ne","i32x4.lt_s","i32x4.lt_u","i32x4.gt_s","i32x4.gt_u","i32x4.le_s","i32x4.le_u","i32x4.ge_s","i32x4.ge_u","f32x4.eq","f32x4.ne","f32x4.lt","f32x4.gt","f32x4.le","f32x4.ge","f64x2.eq","f64x2.ne","f64x2.lt","f64x2.gt","f64x2.le","f64x2.ge","v128.not","v128.and","v128.andnot","v128.or","v128.xor","v128.bitselect","v128.any_true","v128.load8_lane memlane","v128.load16_lane memlane","v128.load32_lane memlane","v128.load64_lane memlane","v128.store8_lane memlane","v128.store16_lane memlane","v128.store32_lane memlane","v128.store64_lane memlane","v128.load32_zero memarg","v128.load64_zero memarg","f32x4.demote_f64x2_zero","f64x2.promote_low_f32x4","i8x16.abs","i8x16.neg","i8x16.popcnt","i8x16.all_true","i8x16.bitmask","i8x16.narrow_i16x8_s","i8x16.narrow_i16x8_u","f32x4.ceil","f32x4.floor","f32x4.trunc","f32x4.nearest","i8x16.shl","i8x16.shr_s","i8x16.shr_u","i8x16.add","i8x16.add_sat_s","i8x16.add_sat_u","i8x16.sub","i8x16.sub_sat_s","i8x16.sub_sat_u","f64x2.ceil","f64x2.floor","i8x16.min_s","i8x16.min_u","i8x16.max_s","i8x16.max_u","f64x2.trunc","i8x16.avgr_u","i16x8.extadd_pairwise_i8x16_s","i16x8.extadd_pairwise_i8x16_u","i32x4.extadd_pairwise_i16x8_s","i32x4.extadd_pairwise_i16x8_u","i16x8.abs","i16x8.neg","i16x8.q15mulr_sat_s","i16x8.all_true","i16x8.bitmask","i16x8.narrow_i32x4_s","i16x8.narrow_i32x4_u","i16x8.extend_low_i8x16_s","i16x8.extend_high_i8x16_s","i16x8.extend_low_i8x16_u","i16x8.extend_high_i8x16_u","i16x8.shl","i16x8.shr_s","i16x8.shr_u","i16x8.add","i16x8.add_sat_s","i16x8.add_sat_u","i16x8.sub","i16x8.sub_sat_s","i16x8.sub_sat_u","f64x2.nearest","i16x8.mul","i16x8.min_s","i16x8.min_u","i16x8.max_s","i16x8.max_u",,"i16x8.avgr_u","i16x8.extmul_low_i8x16_s","i16x8.extmul_high_i8x16_s","i16x8.extmul_low_i8x16_u","i16x8.extmul_high_i8x16_u","i32x4.abs","i32x4.neg",,"i32x4.all_true","i32x4.bitmask",,,"i32x4.extend_low_i16x8_s","i32x4.extend_high_i16x8_s","i32x4.extend_low_i16x8_u","i32x4.extend_high_i16x8_u","i32x4.shl","i32x4.shr_s","i32x4.shr_u","i32x4.add",,,"i32x4.sub",,,,"i32x4.mul","i32x4.min_s","i32x4.min_u","i32x4.max_s","i32x4.max_u","i32x4.dot_i16x8_s",,"i32x4.extmul_low_i16x8_s","i32x4.extmul_high_i16x8_s","i32x4.extmul_low_i16x8_u","i32x4.extmul_high_i16x8_u","i64x2.abs","i64x2.neg",,"i64x2.all_true","i64x2.bitmask",,,"i64x2.extend_low_i32x4_s","i64x2.extend_high_i32x4_s","i64x2.extend_low_i32x4_u","i64x2.extend_high_i32x4_u","i64x2.shl","i64x2.shr_s","i64x2.shr_u","i64x2.add",,,"i64x2.sub",,,,"i64x2.mul","i64x2.eq","i64x2.ne","i64x2.lt_s","i64x2.gt_s","i64x2.le_s","i64x2.ge_s","i64x2.extmul_low_i32x4_s","i64x2.extmul_high_i32x4_s","i64x2.extmul_low_i32x4_u","i64x2.extmul_high_i32x4_u","f32x4.abs","f32x4.neg",,"f32x4.sqrt","f32x4.add","f32x4.sub","f32x4.mul","f32x4.div","f32x4.min","f32x4.max","f32x4.pmin","f32x4.pmax","f64x2.abs","f64x2.neg",,"f64x2.sqrt","f64x2.add","f64x2.sub","f64x2.mul","f64x2.div","f64x2.min","f64x2.max","f64x2.pmin","f64x2.pmax","i32x4.trunc_sat_f32x4_s","i32x4.trunc_sat_f32x4_u","f32x4.convert_i32x4_s","f32x4.convert_i32x4_u","i32x4.trunc_sat_f64x2_s_zero","i32x4.trunc_sat_f64x2_u_zero","f64x2.convert_low_i32x4_s","f64x2.convert_low_i32x4_u","i8x16.relaxed_swizzle","i32x4.relaxed_trunc_f32x4_s","i32x4.relaxed_trunc_f32x4_u","i32x4.relaxed_trunc_f64x2_s_zero","i32x4.relaxed_trunc_f64x2_u_zero","f32x4.relaxed_madd","f32x4.relaxed_nmadd","f64x2.relaxed_madd","f64x2.relaxed_nmadd","i8x16.relaxed_laneselect","i16x8.relaxed_laneselect","i32x4.relaxed_laneselect","i64x2.relaxed_laneselect","f32x4.relaxed_min","f32x4.relaxed_max","f64x2.relaxed_min","f64x2.relaxed_max","i16x8.relaxed_q15mulr_s","i16x8.relaxed_dot_i8x16_i7x16_s","i32x4.relaxed_dot_i8x16_i7x16_add_s"],["memory.atomic.notify memarg","memory.atomic.wait32 memarg","memory.atomic.wait64 memarg","atomic.fence opt_memory",,,,,,,,,,,,,"i32.atomic.load memarg","i64.atomic.load memarg","i32.atomic.load8_u memarg","i32.atomic.load16_u memarg","i64.atomic.load8_u memarg","i64.atomic.load16_u memarg","i64.atomic.load32_u memarg","i32.atomic.store memarg","i64.atomic.store memarg","i32.atomic.store8 memarg","i32.atomic.store16 memarg","i64.atomic.store8 memarg","i64.atomic.store16 memarg","i64.atomic.store32 memarg","i32.atomic.rmw.add memarg","i64.atomic.rmw.add memarg","i32.atomic.rmw8.add_u memarg","i32.atomic.rmw16.add_u memarg","i64.atomic.rmw8.add_u memarg","i64.atomic.rmw16.add_u memarg","i64.atomic.rmw32.add_u memarg","i32.atomic.rmw.sub memarg","i64.atomic.rmw.sub memarg","i32.atomic.rmw8.sub_u memarg","i32.atomic.rmw16.sub_u memarg","i64.atomic.rmw8.sub_u memarg","i64.atomic.rmw16.sub_u memarg","i64.atomic.rmw32.sub_u memarg","i32.atomic.rmw.and memarg","i64.atomic.rmw.and memarg","i32.atomic.rmw8.and_u memarg","i32.atomic.rmw16.and_u memarg","i64.atomic.rmw8.and_u memarg","i64.atomic.rmw16.and_u memarg","i64.atomic.rmw32.and_u memarg","i32.atomic.rmw.or memarg","i64.atomic.rmw.or memarg","i32.atomic.rmw8.or_u memarg","i32.atomic.rmw16.or_u memarg","i64.atomic.rmw8.or_u memarg","i64.atomic.rmw16.or_u memarg","i64.atomic.rmw32.or_u memarg","i32.atomic.rmw.xor memarg","i64.atomic.rmw.xor memarg","i32.atomic.rmw8.xor_u memarg","i32.atomic.rmw16.xor_u memarg","i64.atomic.rmw8.xor_u memarg","i64.atomic.rmw16.xor_u memarg","i64.atomic.rmw32.xor_u memarg","i32.atomic.rmw.xchg memarg","i64.atomic.rmw.xchg memarg","i32.atomic.rmw8.xchg_u memarg","i32.atomic.rmw16.xchg_u memarg","i64.atomic.rmw8.xchg_u memarg","i64.atomic.rmw16.xchg_u memarg","i64.atomic.rmw32.xchg_u memarg","i32.atomic.rmw.cmpxchg memarg","i64.atomic.rmw.cmpxchg memarg","i32.atomic.rmw8.cmpxchg_u memarg","i32.atomic.rmw16.cmpxchg_u memarg","i64.atomic.rmw8.cmpxchg_u memarg","i64.atomic.rmw16.cmpxchg_u memarg","i64.atomic.rmw32.cmpxchg_u memarg"]],g={custom:0,type:1,import:2,func:3,table:4,memory:5,tag:13,global:6,export:7,start:8,elem:9,datacount:12,code:10,data:11},b={i8:120,i16:119,i32:127,i64:126,f32:125,f64:124,void:64,v128:123,exn:105,noexn:116,nofunc:115,noextern:114,none:113,func:112,extern:111,any:110,eq:109,i31:108,struct:107,array:106,nullfuncref:115,nullexternref:114,nullexnref:116,nullref:113,funcref:112,externref:111,exnref:105,anyref:110,eqref:109,i31ref:108,structref:107,arrayref:106,ref:100,refnull:99,sub:80,subfinal:79,rec:78},re={func:96,struct:95,array:94,sub:80,subfinal:79,rec:78},Y={func:0,table:1,memory:2,global:3,tag:4};var E=e=>{let t=0,i=[],r="",a=0,l=0,s=()=>r&&(i.push(r),r=""),f=()=>{for(let n,m;t<e.length;)if(n=e.charCodeAt(t),a===34)r+=e[t++],n===92?r+=e[t++]:n===34&&(s(),a=0);else if(a>59)n===40&&e.charCodeAt(t+1)===59?(a++,r+=e[t++]+e[t++]):n===59&&e.charCodeAt(t+1)===41?(r+=e[t++]+e[t++],--a===59&&(s(),a=0)):r+=e[t++];else if(a<0)n===10||n===13?(r+=e[t++],s(),a=0):r+=e[t++];else if(n===34)r!=="$"&&s(),a=34,r+=e[t++];else if(n===40&&e.charCodeAt(t+1)===59)s(),a=60,r=e[t++]+e[t++];else if(n===59&&e.charCodeAt(t+1)===59)s(),a=-1,r=e[t++]+e[t++];else if(n===40&&e.charCodeAt(t+1)===64)s(),t+=2,r="@",l++,(m=i).push(i=[]),f(),i=m;else if(n===40)s(),t++,l++,(m=i).push(i=[]),f(),i=m;else{if(n===41)return s(),t++,l--;n<=32?(s(),t++):r+=e[t++]}a<0&&s(),s()};return f(),a===34&&_("Unclosed quote"),a>59&&_("Unclosed block comment"),l>0&&_("Unclosed parenthesis"),t<e.length&&_("Unexpected closing parenthesis"),i.length>1?i:i[0]||[]};var se=(e,t)=>Array.isArray(e)?e[0]?.[0]==="@"&&e[0]!=="@custom"&&!e[0]?.startsWith?.("@metadata.code.")?null:(t=e.map(se).filter(i=>i!=null),t.length===1&&t[0]?.[0]==="module"?t[0]:t):typeof e!="string"?e:e[0]===";"||e[1]===";"?null:e[0]==="$"&&e[1]==='"'?e.includes("\\")?"$"+te(e.slice(1)):"$"+e.slice(2,-1):e[0]==='"'?D(e):e;function C(e){typeof e=="string"&&(e=E(e)||[]),e=se(e)||[];let t=0;if(e[0]==="module"?(t++,A(e[t])&&t++):typeof e[0]=="string"&&(e=[e]),e[t]==="binary")return Uint8Array.from(e.slice(++t).flat());if(e[t]==="quote")return C(e.slice(++t).map(l=>l.valueOf().slice(1,-1)).flat().join(""));let i=[];for(let l in g)(i[g[l]]=i[l]=[]).name=l;i.metadata={},e.slice(t).filter(([l,...s])=>{if(l==="@custom")i.custom.push(s);else if(l==="rec")for(let f=0;f<s.length;f++){let[,...n]=s[f];G(n,i.type),(n=ae(n,i)).push(f?!0:[i.type.length,s.length]),i.type.push(n)}else if(l==="type")G(s,i.type),i.type.push(ae(s,i));else if(l==="start"||l==="export")i[l].push(s);else return!0}).forEach(([l,...s])=>{let f;l==="import"&&([l,...s]=(f=s).pop());let n=i[l];for(G(s,n);s[0]?.[0]==="export";)i.export.push([s.shift()[1],[l,n.length]]);if(s[0]?.[0]==="import"&&([,...f]=s.shift()),l==="table"){let m=s[0]==="i64",x=m?1:0;if(s[x+1]?.[0]==="elem"){let[h,[,...y]]=[s[x],s[x+1]];s=m?["i64",y.length,y.length,h]:[y.length,y.length,h],i.elem.push([["table",n.length],["offset",[m?"i64.const":"i32.const",m?0n:0]],h,...y])}}else if(l==="memory"){let m=s[0]==="i64",x=m?1:0;if(s[x]?.[0]==="data"){let[,...h]=s.splice(x,1)[0],y=""+Math.ceil(h.reduce((c,v)=>c+v.length,0)/65536);i.data.push([["memory",n.length],[m?"i64.const":"i32.const",m?0n:0],...h]),s=m?["i64",y,y]:[y,y]}}else if(l==="func"){let[m,x,h]=L(s,i);m??=R(x,h,i),!f&&i.code.push([[m,x,h],...U(s,i)]),s=[["type",m]]}else if(l==="tag"){let[m,x]=L(s,i);m??=R(x,[],i),s=[["type",m]]}f&&(i.import.push([...f,[l,...s]]),s=null),n.push(s)});let r=(l,s=!0)=>{let f=i[l].filter(Boolean).map(n=>X[l](n,i)).filter(Boolean);return l===g.custom?f.flatMap(n=>[l,...p(n)]):f.length?[l,...p(s?p(f):f)]:[]},a=()=>{let l=[];for(let s in i.metadata){let f=p(D(`"metadata.code.${s}"`)),n=p(i.metadata[s].map(([m,x])=>[...o(m),...p(x.map(([h,y])=>[...o(h),...p(y)]))]));l.push(0,...p([...f,...n]))}return l};return Uint8Array.from([0,97,115,109,1,0,0,0,...r(g.custom),...r(g.type),...r(g.import),...r(g.func),...r(g.table),...r(g.memory),...r(g.tag),...r(g.global),...r(g.export),...r(g.start,!1),...r(g.elem),...r(g.datacount,!1),...r(g.code),...a(),...r(g.data)])}var I=e=>e?.[0]==="$"||!isNaN(e),A=e=>e?.[0]==="$",K=e=>e?.[0]==="a"||e?.[0]==="o";function U(e,t){let i=[];for(e=[...e];e.length;){let r=e.shift();if(typeof r=="string")if(i.push(r),r==="block"||r==="if"||r==="loop")A(e[0])&&i.push(e.shift()),i.push(O(e,t));else if(r==="else"||r==="end")A(e[0])&&e.shift();else if(r==="select")i.push(V(e)[1]);else if(r.endsWith("call_indirect")){let a=I(e[0])?e.shift():0,[l,s,f]=L(e,t);i.push(a,["type",l??R(s,f,t)])}else r==="table.init"?i.push(I(e[1])?e.shift():0,e.shift()):r==="table.copy"||r==="memory.copy"?i.push(I(e[0])?e.shift():0,I(e[0])?e.shift():0):r.startsWith("table.")?i.push(I(e[0])?e.shift():0):r==="memory.init"?(i.push(...I(e[1])?[e.shift(),e.shift()].reverse():[e.shift(),0]),t.datacount&&(t.datacount[0]=!0)):r==="data.drop"||r==="array.new_data"||r==="array.init_data"?(r==="data.drop"&&i.push(e.shift()),t.datacount&&(t.datacount[0]=!0)):(r.startsWith("memory.")||r.endsWith("load")||r.endsWith("store"))&&I(e[0])&&i.push(e.shift());else if(Array.isArray(r)){let a=r[0];if(a?.startsWith?.("@metadata.code.")){let s=a.slice(15);i.push(["@metadata",s,r[1]]);continue}if(typeof a!="string"||!Array.isArray(k[a])){i.push(r);continue}let l=r.slice(1);if(a==="block"||a==="loop")i.push(a),A(l[0])&&i.push(l.shift()),i.push(O(l,t),...U(l,t),"end");else if(a==="if"){let s=[],f=[];l.at(-1)?.[0]==="else"&&(f=U(l.pop().slice(1),t)),l.at(-1)?.[0]==="then"&&(s=U(l.pop().slice(1),t));let n=[a];A(l[0])&&n.push(l.shift()),n.push(O(l,t)),i.push(...U(l,t),...n,...s),f.length&&i.push("else",...f),i.push("end")}else if(a==="try_table"){for(i.push(a),A(l[0])&&i.push(l.shift()),i.push(O(l,t));l[0]?.[0]==="catch"||l[0]?.[0]==="catch_ref"||l[0]?.[0]==="catch_all"||l[0]?.[0]==="catch_all_ref";)i.push(l.shift());i.push(...U(l,t),"end")}else{let s=[];for(;l.length&&(!Array.isArray(l[0])||"type,param,result,ref".includes(l[0][0]));)s.push(l.shift());i.push(...U(l,t),a,...s),e.unshift(...i.splice(i.length-1-s.length))}}else i.push(r)}return i}var R=(e,t,i,r="$"+e+">"+t)=>(i.type[r]??=i.type.push(["func",[e,t]])-1,r),H=(e,t)=>{let i=[];for(;e[0]?.[0]===t;){let[,...r]=e.shift(),a=A(r[0])&&r.shift();a&&(a in i?(()=>{throw Error(`Duplicate ${t} ${a}`)})():i[a]=i.length),i.push(...r)}return i},V=e=>{let t=H(e,"param"),i=H(e,"result");if(e[0]?.[0]==="param")throw Error("Unexpected param");return[t,i]},L=(e,t)=>{if(e[0]?.[0]!=="type")return[,...V(e)];let[,i]=e.shift(),[r,a]=V(e),l=t.type[typeof i=="string"&&isNaN(i)?t.type[i]:+i];if(!l)throw Error(`Unknown type ${i}`);if((r.length||a.length)&&l[1].join(">")!==r+">"+a)throw Error(`Type ${i} mismatch`);return[i,...l[1]]},O=(e,t)=>{let[i,r,a]=L(e,t);if(!(!r.length&&!a.length))return!r.length&&a.length===1?["result",...a]:["type",i??R(r,a,t)]},G=(e,t)=>{let i=A(e[0])&&e.shift();return i&&(i in t?_(`Duplicate ${t.name} ${i}`):t[i]=t.length),i},ae=([e],t)=>{let i="subfinal",r=[],a;return e[0]==="sub"&&(i=e.shift(),e[0]==="final"&&(i+=e.shift()),e=(r=e).pop()),[a,...e]=e,a==="func"?(e=V(e),t.type["$"+e.join(">")]??=t.type.length):a==="struct"?e=H(e,"field"):a==="array"&&([e]=e),[a,e,i,r]},X=[([e,...t],i)=>{let r=t;return(t[0]?.[0]==="before"||t[0]?.[0]==="after")&&(r=t.slice(1)),[...p(e),...r.flat()]},([e,t,i,r,a],l)=>{if(a===!0)return;let s;if(a){e="rec";let[f,n]=a,m=Array.from({length:n},(x,h)=>X[g.type](l.type[f+h].slice(0,4),l));s=p(m)}else i==="sub"||r?.length?(s=[...p(r.map(f=>u(f,l.type))),...X[g.type]([e,t],l)],e=i):e==="func"?s=[...p(t[0].map(f=>$(f,l))),...p(t[1].map(f=>$(f,l)))]:e==="array"?s=W(t,l):e==="struct"&&(s=p(t.map(f=>W(f,l))));return[re[e],...s]},([e,t,[i,...r]],a)=>{let l;if(i==="func"){let[[,s]]=r;l=o(u(s,a.type))}else if(i==="tag"){let[[,s]]=r;l=[0,...o(u(s,a.type))]}else i==="memory"?l=j(r):i==="global"?l=W(r[0],a):i==="table"?l=[...$(r.pop(),a),...j(r)]:_(`Unknown kind ${i}`);return[...p(e),...p(t),Y[i],...l]},([[,e]],t)=>o(u(e,t.type)),(e,t)=>{let i=j(e),r=$(e.shift(),t),[a]=e;return a?[64,0,...r,...i,...B(a,t)]:[...r,...i]},(e,t)=>j(e),([e,t],i)=>[...W(e,i),...B(t,i)],([e,[t,i]],r)=>[...p(e),Y[t],...o(u(i,r[t]))],([e],t)=>o(u(e,t.func)),(e,t)=>{let i=0,r=0,a=0,l=0,s,f,n;e[0]==="declare"&&(e.shift(),r=1),e[0]?.[0]==="table"?([,s]=e.shift(),s=u(s,t.table)):(typeof e[0]=="string"||typeof e[0]=="number")&&(e[1]?.[0]==="offset"||Array.isArray(e[1])&&e[1][0]!=="item"&&!e[1][0]?.startsWith("ref"))&&(s=u(e.shift(),t.table)),e[0]?.[0]==="offset"||Array.isArray(e[0])&&e[0][0]!=="item"&&!e[0][0].startsWith("ref")?(f=e.shift(),f[0]==="offset"&&([,f]=f),f=B(f,t)):r||(i=1),b[e[0]]||e[0]?.[0]==="ref"?n=$(e.shift(),t):e[0]==="func"?n=[b[e.shift()]]:n=[b.func],e=e.map(x=>(x[0]==="item"&&(x=x.length===3&&x[1]==="ref.func"?x[2]:x[1]),x[0]==="ref.func"&&([,x]=x),typeof x!="string"&&(a=1),x)),n[0]!==b.funcref&&(l=1,a=1);let m=a<<2|(i||r?r:!!s||l)<<1|(i||r);return[m,...m===0?f:m===1?[0]:m===2?[...o(s||0),...f,0]:m===3?[0]:m===4?f:m===5?n:m===6?[...o(s||0),...f,...n]:n,...p(e.map(a?x=>B(typeof x=="string"?["ref.func",x]:x,t):x=>o(u(x,t.func))))]},(e,t)=>{let[i,r]=e.shift();r||([,[r]]=t.type[u(i,t.type)]),t.local=Object.create(r),t.block=[],t.local.name="local",t.block.name="block",t._codeIdx===void 0&&(t._codeIdx=0);let a=t._codeIdx++;for(;e[0]?.[0]==="local";){let[,...n]=e.shift();if(A(n[0])){let m=n.shift();m in t.local?_(`Duplicate local ${m}`):t.local[m]=t.local.length}t.local.push(...n)}t.meta={};let l=me(e,t),s=t.import.filter(n=>n[2][0]==="func").length+a;for(let n in t.meta)((t.metadata??={})[n]??=[]).push([s,t.meta[n]]);let f=t.local.slice(r.length).reduce((n,m)=>(m==n[n.length-1]?.[1]?n[n.length-1][0]++:n.push([1,m]),n),[]);return t.local=t.block=t.meta=null,p([...p(f.map(([n,m])=>[...o(n),...$(m,t)])),...l])},(e,t)=>{let i,r=0;return e[0]?.[0]==="memory"?([,r]=e.shift(),r=u(r,t.memory)):(typeof e[0]=="string"||typeof e[0]=="number")&&(e[1]?.[0]==="offset"||Array.isArray(e[1])&&typeof e[1][0]=="string")&&(r=u(e.shift(),t.memory)),Array.isArray(e[0])&&typeof e[0]?.[0]=="string"&&(i=e.shift(),i[0]==="offset"&&([,i]=i),i??_("Bad offset",i)),[...r?[2,...o(r),...B(i,t)]:i?[0,...B(i,t)]:[1],...p(e.flat())]},(e,t)=>o(t.data.length),([[,e]],t)=>[0,...o(u(e,t.type))]],$=(e,t)=>e[0]==="ref"?e[1]=="null"?b[e[2]]?[b[e[2]]]:[b.refnull,...o(u(e[e.length-1],t.type))]:[b.ref,...o(b[e[e.length-1]]||u(e[e.length-1],t.type))]:[b[e]??_(`Unknown type ${e}`)],W=(e,t,i=e[0]==="mut"?1:0)=>[...$(i?e[1]:e,t),i],fe={null:()=>[],reversed:(e,t)=>{let i=e.shift(),r=e.shift();return[...o(u(r,t.elem)),...o(u(i,t.table))]},block:(e,t)=>{t.block.push(1),A(e[0])&&(t.block[e.shift()]=t.block.length);let i=e.shift();return i?i[0]==="result"?$(i[1],t):o(u(i[1],t.type)):[b.void]},try_table:(e,t)=>{A(e[0])&&(t.block[e.shift()]=t.block.length+1);let i=e.shift(),r=i?i[0]==="result"?$(i[1],t):o(u(i[1],t.type)):[b.void],a=[],l=0;for(;e[0]?.[0]==="catch"||e[0]?.[0]==="catch_ref"||e[0]?.[0]==="catch_all"||e[0]?.[0]==="catch_all_ref";){let s=e.shift(),f=s[0]==="catch"?0:s[0]==="catch_ref"?1:s[0]==="catch_all"?2:3;f<=1?a.push(f,...o(u(s[1],t.tag)),...o(T(s[2],t.block))):a.push(f,...o(T(s[1],t.block))),l++}return t.block.push(1),[...r,...o(l),...a]},end:(e,t)=>(t.block.pop(),[]),call_indirect:(e,t)=>{let i=e.shift(),[,r]=e.shift();return[...o(u(r,t.type)),...o(u(i,t.table))]},br_table:(e,t)=>{let i=[],r=0;for(;e[0]&&(!isNaN(e[0])||A(e[0]));)i.push(...o(T(e.shift(),t.block))),r++;return[...o(r-1),...i]},select:(e,t)=>{let i=e.shift()||[];return i.length?p(i.map(r=>$(r,t))):[]},ref_null:(e,t)=>{let i=e.shift();return b[i]?[b[i]]:o(u(i,t.type))},memarg:(e,t,i)=>le(e,i,I(e[0])&&!K(e[0])?u(e.shift(),t.memory):0),opt_memory:(e,t)=>o(u(I(e[0])?e.shift():0,t.memory)),reftype:(e,t)=>{let i=$(e.shift(),t);return i.length>1?i.slice(1):i},reftype2:(e,t)=>{let i=T(e.shift(),t.block),r=$(e.shift(),t),a=$(e.shift(),t);return[(a[0]!==b.ref)<<1|r[0]!==b.ref,...o(i),r.pop(),a.pop()]},v128const:e=>{let[t,i]=e.shift().split("x"),r=+t.slice(1),a=r>>>3;if(i=+i,t[0]==="i"){let s=i===16?new Uint8Array(16):i===8?new Uint16Array(8):i===4?new Uint32Array(4):new BigUint64Array(2);for(let f=0;f<i;f++)s[f]=z[t].parse(e.shift());return[...new Uint8Array(s.buffer)]}let l=new Uint8Array(16);for(let s=0;s<i;s++)l.set(z[t](e.shift()),s*a);return[...l]},shuffle:e=>{let t=[];for(let i=0;i<16;i++)t.push(P(e.shift(),32));return typeof e[0]=="string"&&!isNaN(e[0])&&_("invalid lane length"),t},memlane:(e,t,i)=>{let r=A(e[0])||I(e[0])&&(K(e[1])||I(e[1]))?u(e.shift(),t.memory):0;return[...le(e,i,r),...o(P(e.shift()))]},"*":e=>o(e.shift()),labelidx:(e,t)=>o(T(e.shift(),t.block)),laneidx:e=>[P(e.shift(),255)],funcidx:(e,t)=>o(u(e.shift(),t.func)),typeidx:(e,t)=>o(u(e.shift(),t.type)),tableidx:(e,t)=>o(u(e.shift(),t.table)),memoryidx:(e,t)=>o(u(e.shift(),t.memory)),globalidx:(e,t)=>o(u(e.shift(),t.global)),localidx:(e,t)=>o(u(e.shift(),t.local)),dataidx:(e,t)=>o(u(e.shift(),t.data)),elemidx:(e,t)=>o(u(e.shift(),t.elem)),tagidx:(e,t)=>o(u(e.shift(),t.tag)),"memoryidx?":(e,t)=>o(u(I(e[0])?e.shift():0,t.memory)),i32:e=>N(e.shift()),i64:e=>q(e.shift()),f32:e=>M(e.shift()),f64:e=>F(e.shift()),v128:e=>(void 0)(e.shift()),typeidx_field:(e,t)=>{let i=u(e.shift(),t.type);return[...o(i),...o(u(e.shift(),t.type[i][1]))]},typeidx_multi:(e,t)=>[...o(u(e.shift(),t.type)),...o(e.shift())],typeidx_dataidx:(e,t)=>[...o(u(e.shift(),t.type)),...o(u(e.shift(),t.data))],typeidx_elemidx:(e,t)=>[...o(u(e.shift(),t.type)),...o(u(e.shift(),t.elem))],typeidx_typeidx:(e,t)=>[...o(u(e.shift(),t.type)),...o(u(e.shift(),t.type))],dataidx_memoryidx:(e,t)=>[...o(u(e.shift(),t.data)),...o(u(e.shift(),t.memory))],memoryidx_memoryidx:(e,t)=>[...o(u(e.shift(),t.memory)),...o(u(e.shift(),t.memory))],tableidx_tableidx:(e,t)=>[...o(u(e.shift(),t.table)),...o(u(e.shift(),t.table))]},S={};(function e(t,i){for(let r=0,a,l,s;r<t.length;r++)(a=t[r])&&(Array.isArray(a)?e(a,r):([l,s]=a.split(" "),k[l]=i?[i,...o(r)]:[r],s&&(S[l]=fe[s])))})(k);var me=(e,t)=>{let i=[],r=[];for(;e?.length;){let a=e.shift();if(a?.[0]==="@metadata"){r.push(a.slice(1));continue}let[...l]=k[a]||_(`Unknown instruction ${a}`);S[a]&&(a==="select"&&e[0]?.length?l[0]++:S[a]===fe.reftype&&(e[0][1]==="null"||e[0][0]!=="ref")&&l[l.length-1]++,l.push(...S[a](e,t,a)));for(let[s,f]of r)(t.meta[s]??=[]).push([i.length,f]);i.push(...l)}return i.push(11),i},B=(e,t)=>me(U([e],t),t),u=(e,t,i)=>(i=A(e)?t[e]:+e,i in t?i:_(`Unknown ${t.name} ${e}`)),T=(e,t,i)=>(i=A(e)?t.length-t[e]:+e,isNaN(i)||i>t.length?_(`Bad label ${e}`):i),ve=e=>{let t,i,r,a;for(;K(e[0]);)[r,a]=e.shift().split("="),r==="offset"?i=+a:r==="align"?t=+a:_(`Unknown param ${r}=${a}`);return(i<0||i>4294967295)&&_(`Bad offset ${i}`),(t<=0||t>4294967295)&&_(`Bad align ${t}`),t&&(t=Math.log2(t))%1&&_(`Bad align ${t}`),[t,i]},le=(e,t,i=0)=>{let[r,a]=ve(e),l=(r??$e(t))|(i&&64);return i?[...o(l),...o(i),...o(a??0)]:[...o(l),...o(a??0)]},$e=e=>{let t=e.indexOf(".",3)+1,i=e.slice(1,e[0]==="v"?4:3);if(e[t]==="a"&&(t=e.indexOf(".",t)+1),e[0]==="m")return e.includes("64")?3:2;if(e[t]==="r"){let l=e.slice(t,t+6).match(/\d+/);return Math.log2(l?l[0]/8:+i/8)}let r=e[t]==="l"?t+4:t+5,a=e.slice(r).match(/(\d+)(x|_|$)/);return Math.log2(a?a[2]==="x"?8:a[1]/8:+i/8)},j=e=>{let t=e[0]==="i64"&&e.shift(),i=e[e.length-1]==="shared"&&e.pop(),r=!isNaN(parseInt(e[1])),a=(t?4:0)|(i?2:0)|(r?1:0),l=t?s=>{if(typeof s=="bigint")return s;let f=typeof s=="string"?s.replaceAll("_",""):String(s);return BigInt(f)}:P;return r?[a,...o(l(e.shift())),...o(l(e.shift()))]:[a,...o(l(e.shift()))]},P=(e,t=4294967295)=>{let i=typeof e=="string"&&e[0]!=="+"?N.parse(e):typeof e=="number"?e:_(`Bad int ${e}`);return i>t?_(`Value out of range ${e}`):i},p=e=>[...o(e.length),...e.flat()];function ne(e,t={}){typeof e=="string"&&(e=E(e));let{indent:i="  ",newline:r=`
`,comments:a=!0}=t;if(i||="",r||="",typeof e[0]=="string"&&e[0][0]!==";")return s(e);return e.filter(f=>a||!l(f)).map(f=>s(f)).join(r);function l(f){return typeof f=="string"&&f[1]===";"}function s(f,n=0){if(!Array.isArray(f))return f;let m=f[0];if(!m)return"";let x=!1;if(m==="try_table"){let c=1;for(typeof f[c]=="string"&&f[c][0]==="$"&&(m+=" "+f[c++]),Array.isArray(f[c])&&(f[c][0]==="result"||f[c][0]==="type")&&(m+=" "+s(f[c++],n));Array.isArray(f[c])&&/^catch/.test(f[c][0]);)m+=" "+s(f[c++],n).trim();for(;c<f.length;c++)m+=Array.isArray(f[c])?r+i.repeat(n+1)+s(f[c],n+1):" "+f[c];return`(${m+r+i.repeat(n)})`}let h=!!r&&f.length<4&&!f.some(c=>typeof c=="string"&&c[0]===";"&&c[1]===";"),y=i.repeat(n+1);for(let c=1;c<f.length;c++){let v=f[c].valueOf();if(typeof v=="string"&&v[1]===";"){if(!a)continue;if(v[0]===";")if(r)m+=r+y+v.trimEnd(),x=!0;else{let w=m[m.length-1];w&&w!==" "&&w!=="("&&(m+=" "),m+=v.trimEnd()+`
`}else{let w=m[m.length-1];w&&w!==" "&&w!=="("&&(m+=" "),m+=v.trimEnd()}}else if(Array.isArray(v))h&&(h=v.every(w=>!Array.isArray(w))),m+=r+y+s(v,n+1),x=!1;else if(f[0]==="data")h=!1,(r||m[m.length-1]!==")")&&(m+=r||" "),m+=y+v,x=!1;else{let w=m[m.length-1];x&&r?m+=r+y:w===`
`?m+="":(w&&w!==")"&&w!==" "||r||w===")")&&(m+=" "),m+=v,x=!1}}return h?`(${m.replaceAll(r+y+"("," (")})`:`(${m+r+i.repeat(n)})`}}var oe="\uE000",xe=e=>{if(!e||typeof e!="string")return null;let t=e.split(".")[0];return/^[if](32|64)|v128/.test(t)?t:/\.(eq|ne|[lg][te]|eqz)/.test(e)||e==="memory.size"||e==="memory.grow"?"i32":null},Ie=(e,t={})=>{if(!Array.isArray(e))return typeof e=="string"&&e[0]==="$"&&t.locals?.[e]?t.locals[e]:null;let[i,...r]=e;return xe(i)?xe(i):i==="local.get"&&t.locals?.[r[0]]?t.locals[r[0]]:i==="call"&&t.funcs?.[r[0]]?t.funcs[r[0]].result?.[0]:null};function J(e,t){if(e=t(e),Array.isArray(e))for(let i=0;i<e.length;i++){let r=J(e[i],t);r?._splice?(e.splice(i,1,...r),i+=r.length-1):e[i]=r}return e}function Ne(e,t){let i=[],r=new Map;return J(e,a=>{if(!Array.isArray(a))return a;if(a[0]==="call"&&typeof a[1]=="function"){let l=a[1];if(!r.has(l)){let f=[];for(let x=2;x<a.length;x++){let h=Ie(a[x]);h&&f.push(h)}let n=i.length,m=l.name||`$fn${n}`;r.set(l,{idx:n,name:m.startsWith("$")?m:"$"+m,params:f,fn:l}),i.push(r.get(l))}let s=r.get(l);a[1]=s.name}return a}),i}function Ue(e){return e.map(({name:t,params:i})=>["import",'"env"',`"${t.slice(1)}"`,["func",t,...i.map(r=>["param",r])]])}function Ee(e,...t){if(Array.isArray(e)&&e.raw){let i=e[0];for(let n=0;n<t.length;n++)i+=oe+e[n+1];let r=E(i),a=[],l=0;r=J(r,n=>{if(n===oe){let m=t[l++];if(typeof m=="function")return a.push(m),m;if(typeof m=="string"&&(m[0]==="("||/^\s*\(/.test(m))){let x=E(m);return Array.isArray(x)&&Array.isArray(x[0])&&(x._splice=!0),x}return m instanceof Uint8Array?[...m]:m}return n});let s=null;if(a.length){let n=Ne(r,a);if(n.length){let m=Ue(n);r[0]==="module"?r.splice(1,0,...m):typeof r[0]=="string"?r=[...m,r]:r.unshift(...m),s={env:{}};for(let x of n)s.env[x.name.slice(1)]=x.fn}}let f=C(r);return s&&(f._imports=s),f}return C(e)}function qe(e,...t){let i=Ee(e,...t),r=new WebAssembly.Module(i);return new WebAssembly.Instance(r,i._imports).exports}var Ge=qe;export{Ee as compile,Ge as default,E as parse,ne as print,qe as watr};
